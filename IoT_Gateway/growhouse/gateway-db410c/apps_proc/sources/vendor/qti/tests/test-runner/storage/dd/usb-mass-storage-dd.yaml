#Copyright (c) 2017, The Linux Foundation. All rights reserved.
#
#Redistribution and use in source and binary forms, with or without
#modification, are permitted provided that the following conditions are
#met:
#    * Redistributions of source code must retain the above copyright
#      notice, this list of conditions and the following disclaimer.
#    * Redistributions in binary form must reproduce the above
#      copyright notice, this list of conditions and the following
#      disclaimer in the documentation and/or other materials provided
#      with the distribution.
#    * Neither the name of The Linux Foundation nor the names of its
#      contributors may be used to endorse or promote products derived
#      from this software without specific prior written permission.
#
#THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
#WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
#MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
#ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
#BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
#CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
#SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
#BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
#WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
#OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
#IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
metadata:
    format: Lava-Test Test Definition 1.0
    name: usb-mass-storage-dd-test

    description: "Checking USB mass storage read write benchmarks for dd command.
                  After running dd command for read write operations, results will be compared with
                  KPI benchmarks given in a script params."
    maintainer:

    os:
        - openembedded
    scope:
        - functional
    devices:
        - apq8016-sbc

params:
    # storage_device_type          : Must be one of these: onboard_flash, sdcard-HC, sdcard-XC, sdcard-regular, usb
    # dd_test_filesize             : file size(MB) which is being read/write using dd command on storage device. if not given defaults to 1024
    # dd_write_KPI_MBps_threshold  : write operation dd benchmark MBps. if not given defaults to 0
    # dd_read_KPI_MBps_threshold   : read operation dd benchmark MBps. if not given defaults to 0

    # Note: 
    #   If dd_write_KPI_MBps_threshold/dd_read_KPI_MBps_threshold not supplied in script params, 
    #     1. It's default value will be 0.
    #     2. Test will always pass because measured data transfer rate will be more than the default value 0.
    #     3. measured data transfer rate will be printed in final results
    #     4. test will fail if measured data rate will be less then the given KPI parmater

    #usage e.g: ./storage-dd.sh -d "${storage_device_type}" -f "${dd_test_filesize}" -w "${dd_write_KPI_MBps_threshold}" -r "${dd_read_KPI_MBps_threshold}"

    storage_device_type: "usb"
    #dd_test_filesize: "1024"
    #dd_write_KPI_MBps_threshold: "0"
    #dd_read_KPI_MBps_threshold: "0" 

run:
    steps:
        - cd ./automated/linux/storage/dd
        - ./storage-dd.sh -d "${storage_device_type}"
        - ../../../utils/send-to-lava.sh ./output/result.txt
